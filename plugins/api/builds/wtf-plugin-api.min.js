!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).wtfApi=e()}(this,(function(){"use strict";function t(t=""){return t=(t=t.replace(/ /g,"_")).trim(),t=encodeURIComponent(t)}const e={lang:"en",path:"w/api.php"};function n(t){return Object.entries(t).map((([t,e])=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&")}function r(t,e,n){return e(t).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?{pages:[],cursor:null}:{pages:t.query.pages[e[0]][n]||[],cursor:t.continue}}))}const o={action:"query",rdnamespace:0,prop:"redirects",rdlimit:500,format:"json",origin:"*",redirects:!0};function i(e,r,i){let c=`https://${r.lang}.wikipedia.org/${r.path}?`;return r.domain&&(c=`https://${r.domain}/${r.path}?`),c+=n(o),c+="&titles="+t(e),i&&(c+=i),c}const c=async function(t,n){let o=[],c=!0,a="";for(;c;){let u=i(t,e,a),{pages:s,cursor:p}=await r(u,n,"redirects");o=o.concat(s),p&&p.rdcontinue?a="&rdcontinue="+p.lhcontinue:c=!1}return o},a={action:"query",lhnamespace:0,prop:"linkshere",lhshow:"!redirect",lhlimit:500,format:"json",origin:"*",redirects:!0};function u(e,r,o){let i=`https://${r.lang}.wikipedia.org/${r.path}?`;return r.domain&&(i=`https://${r.domain}/${r.path}?`),i+=n(a),i+="&titles="+t(e),o&&(i+=o),i}const s=async function(t,n){let o=[],i=!0,c="";for(;i;){let a=u(t,e,c),{pages:s,cursor:p}=await r(a,n,"linkshere");o=o.concat(s),p&&p.lhcontinue?c="&lhcontinue="+p.lhcontinue:i=!1}return o},p={action:"query",prop:"pageviews",format:"json",origin:"*",redirects:!0};function l(r,o){return o(function(e,r,o){let i=`https://${r.lang}.wikipedia.org/${r.path}?`;return r.domain&&(i=`https://${r.domain}/${r.path}?`),i+=n(p),i+="&titles="+t(e),o&&(i+=o),i}(r.title(),e)).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?[]:t.query.pages[e[0]].pageviews||[]}))}const f={action:"query",tinamespace:0,prop:"transcludedin",tilimit:500,format:"json",origin:"*",redirects:!0};function g(e,r,o){let i=`https://${r.lang}.wikipedia.org/${r.path}?`;return r.domain&&(i=`https://${r.domain}/${r.path}?`),i+=n(f),i+="&titles="+t(e),o&&(i+=o),i}const h={action:"query",list:"categorymembers",cmlimit:500,cmtype:"page|subcat",cmnamespace:0,format:"json",origin:"*",redirects:!0};function m(t,e,n){return e(t).then((t=>{let e=Object.keys(t.query[n]||{});return 0===e.length?{pages:[],cursor:null}:{pages:e.map((e=>t.query[n][e])),cursor:t.continue}}))}function d(e,r,o){let i=`https://${r.lang}.wikipedia.org/${r.path}?`;return r.domain&&(i=`https://${r.domain}/${r.path}?`),i+=n(h),!1===/^Category/i.test(e)&&(e="Category:"+e),i+="&cmtitle="+t(e),o&&(i+=o),i}const y={action:"query",generator:"random",grnnamespace:"0",prop:"revisions",rvprop:"content",grnlimit:"1",rvslots:"main",format:"json",origin:"*",redirects:"true"};const w=async function(t,r,o){let i=function(t){let e=`https://${t.lang}.wikipedia.org/${t.path}?`;return t.domain&&(e=`https://${t.domain}/${t.path}?`),e+=n(y),e}(e),c={};try{c=await function(t,e){return e(t).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?{pages:[],cursor:null}:t.query.pages[e[0]]}))}(i,r)||{}}catch(t){console.error(t)}let a=c.title,u="";return c.revisions&&c.revisions[0]&&c.revisions[0].slots&&(u=c.revisions[0].slots.main["*"]||""),o(u,{title:a})},$={format:"json",action:"query",generator:"random",grnnamespace:14,prop:"revisions",grnlimit:1,origin:"*"};var j=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return new Promise((function(r,o){if(t&&e)if(0!==t.length)for(var i=[],c=n-1,a=0,u=function n(u){a+=1;var s=e(t[u]);s.then?(s.then((function(t){i[u]=t})),s.catch((function(t){console.error(t),i[u]=null})),s.finally((function(){a-=1,c+=1,t.length>=c+1?n(c):a<=0&&r(i)}))):o("Error: function must return a promise")},s=t.length<n?t.length:n,p=0;p<s;p+=1)u(p);else r([]);else o("Error: missing required parameters to rate-limit function")}))},v={one:function(t,e){return j(t,e,1)},two:function(t,e){return j(t,e,2)},three:function(t,e){return j(t,e,3)},four:function(t,e){return j(t,e,4)},five:function(t,e){return j(t,e,5)},ten:function(t,e){return j(t,e,10)},fifteen:function(t,e){return j(t,e,15)}};v.serial=v.one,v.linear=v.one,v.crawl=v.three,v.walk=v.five,v.run=v.ten,v.sprint=v.fifteen;var q=v;function b(t,e,n){var r;t[0]&&((r=t[0])&&"[object Object]"===Object.prototype.toString.call(r))&&(t=t.map((t=>t.title)));let o=function(t,e=5){let n=[];for(let r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}(t);return q.three(o,(function(t){return n.fetch(t,e)})).then((t=>t.reduce(((t,e)=>t=t.concat(e)))))}return function(t){t.Doc.prototype.getRedirects=function(){return c(this.title(),t.http)},t.Doc.prototype.getIncoming=function(){return s(this.title(),t.http)},t.Doc.prototype.getPageViews=function(){return l(this,t.http)},t.wtf.getRandomPage=function(e){return w(0,t.http,t.wtf)},t.wtf.getRandomCategory=function(r){return function(t={},r){let o=`https://${(t=Object.assign({},e,t)).lang}.wikipedia.org/${t.path}?`;return t.domain&&(o=`https://${t.domain}/${t.path}?`),o+=n($),r(o).then((t=>{try{let e=t.query.pages;return e[Object.keys(e)[0]].title}catch(t){throw t}})).catch((t=>(console.error(t),null)))}(r,t.http)},t.wtf.getTemplatePages=function(n,o){return async function(t,n,o){let i=[],c=!0,a="";for(;c;){let n=g(t,e,a),{pages:u,cursor:s}=await r(n,o,"transcludedin");i=i.concat(u),s&&s.ticontinue?a="&ticontinue="+s.ticontinue:c=!1}return i}(n,0,t.http)},t.wtf.getCategoryPages=function(n,r){return async function(t,n,r){n={...e,...n};let o=[],i=!0,c="";for(;i;){let e=d(t,n,c),{pages:a,cursor:u}=await m(e,r,"categorymembers");o=o.concat(a),u&&u.cmcontinue?c="&cmcontinue="+u.lhcontinue:i=!1}return o}(n,r,t.http)},t.wtf.fetchList=function(e,n){return b(e,n,t.wtf)},t.wtf.getIncoming=function(e){return s(e,t.http)},t.wtf.getRedirects=function(e){return c(e,t.http)},t.wtf.random=t.wtf.getRandomPage}}));
